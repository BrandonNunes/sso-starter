import{av as Ce,s as B,ac as re,W as be,r,j as h,Y as ce,a as t,_ as de,$ as ie,E as ue,aa as ve,B as I,b as me,h as pe,i as ye,ah as g,aN as Se,ai as he,a7 as R,a0 as j,D as xe,an as fe,L as we,aD as ge,ag as Ie,d as Ne,aw as Fe,M as Le,ax as Te,ay as se,az as ne,aE as Ae,aF as ke,aG as Ee}from"./index-7cffcf74.js";const Re=Ce`
  from {
    transform: translateX(100%);
  }

  to {
    transform: translateX(0%);
  }
`,De=B.div`
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  width: 100%;
  padding: 20px;
  gap: 20px;
  animation: ${Re} 0.3s linear alternate;
`,Oe=B.article`
  display: flex;
  align-items: center;
  gap: 16px;
`;function Pe({newItemDialog:p,closeDialog:y,catalogo:l,refreshListCatalogo:D}){const{addItemInCatalogo:N}=re(),{register:O,handleSubmit:b,formState:{errors:F},reset:v,control:L,setValue:S,resetField:V}=be({defaultValues:{id:0,ativo:!0,descricao:"",id_catalogo:l==null?void 0:l.id}}),T=r.useRef(null),x=(i,u,n="",c=4e3)=>{T.current!=null&&T.current.show({severity:i,summary:u,detail:n,life:c})};return h(ce,{visible:p,style:{width:"450px"},header:"Cadastrar novo item no catálogo",modal:!0,className:"p-fluid",onHide:()=>y(!1),children:[t(de,{ref:T,position:"top-right"}),h(Me,{onSubmit:b(i=>{N(i).then(u=>{let n=u.data[0].msg,c=u.data[0].erro;if(c&&c=="true"){x("error","Falha ao Cadastrar",`${n||"Erro ao cadastrar"}`,1e4);return}c&&c=="false"&&(x("success","Sucesso",`${n||"Cadastro realizado com sucesso"}`),v()),D(l==null?void 0:l.sigla),setTimeout(()=>y(!1),1e3)}).catch(u=>{console.error(u),x("error","Falha ao Cadastrar",`${u.response.data.msg}`,1e4)})}),children:[t(ie,{name:"descricao",control:L,rules:{required:!1},render:({field:i,fieldState:u})=>{var n;return h("span",{className:"p-float-label",style:{width:"90%"},children:[t(ue,{id:"descricao",style:{width:"100%"},...O("descricao"),maxLength:80,className:((n=F.descricao)==null?void 0:n.type)==="required"?"p-invalid":""}),t("label",{htmlFor:"descricao",children:"Descricao"})]})}}),t(ie,{name:"ativo",control:L,rules:{required:!1},render:({field:i,fieldState:u})=>h("div",{style:{display:"flex",gap:"5px"},children:[t("label",{htmlFor:i.name,style:{fontSize:"0.9em"},children:"Ativo"}),t(ve,{inputId:i.name,checked:i.value,inputRef:i.ref,onChange:n=>i.onChange(n.value)})]})}),t($e,{children:t(I,{label:"Salvar",icon:"pi pi-check",style:{width:"100px"},className:"p-button-success",type:"submit"})})]})]})}const Me=B.form`
  display: flex;
  flex-direction: column;
  gap: 15px;
  padding: 20px 0 0 15px;
`,$e=B.div`
  display: flex;
  width: 100%;
  gap: 10px;
  justify-content: flex-end;
`;function Ge({openItens:p,setOPenItens:y,catalogo:l}){const[D,N]=r.useState(!1),[O,b]=r.useState(!1),[F,v]=r.useState([]),[L,S]=r.useState(!1),V=r.useRef(!1),{getListItensCatalogoService:T,updateItemInCatalogoService:x,deleteItemInCatalogoService:W}=re(),{tokenSignature:i,storeUser:u}=me(e=>e),{havePermission:n}=pe(),{openNotification:c}=ye(),H=[{field:"id",header:"Código"},{field:"descricao",header:"Descrição"},{field:"ativo",header:"Status"}],P=e=>{b(!0),T(e).then(s=>{v(s.data)}).catch(s=>{console.warn(s)}).finally(()=>b(!1))},M=(e,s)=>{b(!0),x(e,s).then(o=>{let d=o.data[0].msg,f=o.data[0].erro;if(f&&f=="true"){c("error","Falha",`${d||"Erro ao cadastrar"}`,1e4);return}f&&f=="false"&&c("success","Sucesso",`${d||"Processado realizado com sucesso"}`)}).catch(o=>{console.error(o),c("error","Falha ao Cadastrar",`${o.response.data.msg}`,1e4)}).finally(()=>b(!1))},U=async e=>{W(e).then(s=>{let o=s.data[0].msg;if(s.data[0].erro=="true"){c("error","Falha na execução",`${o}`,1e4);return}c("success","Sucesso",`${o||""}`),P(l==null?void 0:l.sigla)}).catch(s=>{console.error(s),c("error","Falha na execução",`${s.response.data.msg}`,1e4)})};r.useEffect(()=>{V.current=!0},[]),r.useEffect(()=>{i&&P(l==null?void 0:l.sigla)},[l==null?void 0:l.sigla,i]);const K=e=>{e.value.forEach((o,d)=>{M(o,d+1)}),v(e.value),J(e.value)},$=e=>{let s=[...F],{newData:o,index:d}=e;s[d]=o,v(s),M(s[d])},q=e=>{let{rowData:s,newValue:o,field:d,originalEvent:f}=e;d==="ativo"&&(s[d]=o),o.trim().length>0?s[d]=o:f.preventDefault()},z=e=>e.field==="descricao"?X(e):e.field==="ativo"?G(e):t("div",{children:e.value}),X=e=>t(ue,{type:"text",value:e.value,onChange:s=>e.editorCallback(s.target.value)}),G=e=>{const s=[{name:"Ativo",value:!0},{name:"Inativo",value:!1}];return t(xe,{optionLabel:"name",optionValue:"value",value:e.value,options:s,onChange:o=>e.editorCallback(o.value),placeholder:""})},A=e=>t("div",{children:e.ativo?"ATIVO":"INATIVO"}),k=e=>h("div",{style:{display:"flex",gap:"5px"},children:[t(fe,{visible:D,onHide:()=>N(!1),message:"Are you sure you want to proceed?",header:"Confirmation",icon:"pi pi-exclamation-triangle"}),e.privado?null:t(I,{icon:"pi pi-trash",className:"p-button-rounded p-button-text",style:{color:"#333"},"aria-label":"delete",title:"Apagar item",onClick:()=>le(e)})]}),Y=H.map((e,s)=>e.field==="ativo"?t(g,{columnKey:e.field,field:e.field,header:e.header,body:A,editor:o=>z(o),onCellEditComplete:q},e.field):t(g,{columnKey:e.field,field:e.field,header:e.header,editor:o=>z(o),onCellEditComplete:q},e.field)),J=e=>{e.forEach((s,o)=>{console.log(s.id,o+1)})},Q=()=>{_()},_=()=>{y(!1)},Z=()=>{S(!0)},ee=()=>t(we.Fragment,{children:n(R.CATALOGO,j.INCLUIR)?t(I,{label:"Novo",icon:"pi pi-plus",className:"p-button-success mr-2",onClick:Z,style:{display:"flex",gap:"10px"}}):null}),te=t("div",{style:{display:"flex",width:"100%",justifyContent:"flex-end"},children:t(I,{label:"Fechar",icon:"pi pi-times",className:"p-button-danger",style:{display:"flex",gap:"10px"},onClick:_})}),le=e=>{ge({message:"Você está certo que deseja apagar este item?",header:"Confirmar",icon:"pi pi-exclamation-triangle",rejectLabel:"Cancelar",acceptLabel:"Sim",acceptClassName:"red",accept:()=>U(e),reject:()=>null})};return h(ce,{header:"Detalhes do catálogo",footer:te,visible:p,style:{minWidth:"80vw",minHeight:"90vh"},modal:!0,onHide:Q,children:[t(Se,{className:"mb-4",left:ee}),t(Pe,{newItemDialog:L,closeDialog:S,catalogo:l,refreshListCatalogo:P}),h(he,{value:F,editMode:"row",reorderableColumns:!0,loading:O,reorderableRows:!0,onRowReorder:K,emptyMessage:"Sem dados a exibir",onRowEditComplete:$,children:[t(g,{rowReorder:!0,style:{width:"3em"}}),Y,t(g,{header:"Ações",rowEditor:n(R.CATALOGO,j.ALTERAR),headerStyle:{width:"10%",minWidth:"8rem"},bodyStyle:{textAlign:"center"},colSpan:2}),t(g,{body:k,style:{width:"2em"},rowEditor:!0})]})]})}function Ve(){const{colors:p}=r.useContext(Ie),[y,l]=r.useState(),[D,N]=r.useState(!1),[O,b]=r.useState(void 0),[F,v]=r.useState(""),[L,S]=r.useState(!1),[V,T]=r.useState(10),[x,W]=r.useState([]),[i,u]=r.useState([]),[n,c]=r.useState(null),{formCatalogos:H,setRefreshListCatalogos:P}=Ne(a=>a),{tokenSignature:M}=me(a=>a),{getListAllCatalogosService:U,deleteCatalogosService:K}=re(),{havePermission:$}=pe(),q=a=>{const m=a.target.value;let w={...y};w.global.value=m,l(w),v(m)},z=()=>{l({global:{value:null,matchMode:se.CONTAINS},grupo:{operator:ne.AND,constraints:[{value:null,matchMode:se.STARTS_WITH}]},descricao:{operator:ne.AND,constraints:[{value:null,matchMode:se.STARTS_WITH}]}}),v("")};r.useEffect(()=>{z()},[]);const X=(a,m)=>{const w=m.target.checked;let E=a.id,C=i;if(w){C==null||C.push({sequencial:+E});let ae=C.filter(oe=>oe.sequencial!=0);u(ae)}else{let ae=C==null?void 0:C.filter(oe=>oe.sequencial!=+E);u(ae)}},G=r.useRef(null),A=(a,m,w="",E=4e3)=>{G.current!=null&&G.current.show({severity:a,summary:m,detail:w,life:E,contentStyle:{display:"flex",gap:"20px"}})},k=async()=>{S(!0),U().then(a=>{W(a.data),S(!1)}).catch(a=>{S(!1),console.error(a),A("warn","Falha ao obter lista de Catálogos disponíveis","")})},{listModuleFilters:Y,operatorsFilters:J,createFilter:Q,loading:_,clearFilter:Z,haveApplyFilters:ee}=Fe({module:R.CATALOGO,refreshList:k}),te=()=>{ge({message:`Você está certo que deseja apagar o${i.length>1?"s":""} registro${i.length>1?"s":""} selecionado${i.length>1?"s":""}?`,header:"Confirmar",icon:"pi pi-exclamation-triangle",rejectLabel:"Cancelar",acceptLabel:"Sim",acceptClassName:"red",accept:()=>s(),reject:()=>null})},e=(()=>h(Ae,{children:[t(ke,{listModuleFilters:Y,operatorsFilters:J,setFilters:Q,loading:_,clearFilter:Z,haveApplyFilters:ee}),h("span",{className:"p-input-icon-left",style:{height:"30px"},children:[t("i",{className:"pi pi-search"}),t(Ee,{value:F,onChange:q,placeholder:"Buscar"})]})]}))(),s=async()=>{K(i).then(a=>{console.log(a);let m=a.data[0].msg;if(a.data[0].erro=="true"){console.log("chegou erro"),A("error","Falha na execução",`${m}`,1e4);return}A("success","Sucesso",`${m||""}`),u([]),k();const E=document.getElementsByTagName("input");for(let C of E)C.checked=!1}).catch(a=>{console.error(a),A("error","Falha na execução",`${a.response.data.msg}`,1e4)})};r.useEffect(()=>{setTimeout(()=>{M&&k()},500),P(k)},[M]);const o=r.useRef(null);let d=[{label:"Opções",items:[{label:"Visualizar",icon:"pi pi-fw pi-pencil",command:a=>H(n)},{label:"Itens do Catálogo",icon:"pi pi-file-edit",command:a=>{N(!0)},disabled:!$(R.CATALOGO,j.INCLUIR)}]}];const f={headerStyle:{fontSize:"14px",fontWeight:"bold",backgroundColor:p.backgroundColor,color:p.textColor},bodyStyle:{fontSize:"12px",fontWeight:600,backgroundColor:p.backgroundColor,color:p.textColor}};return h(De,{children:[t(de,{ref:G,position:"top-right"}),t(fe,{}),t(Ge,{openItens:D,setOPenItens:N,catalogo:O}),h(Oe,{children:[t(I,{label:"Novo Catálogo",icon:"pi pi-plus-circle",iconPos:"left",className:"p-button-danger new-btn",disabled:!$(R.CATALOGO,j.INCLUIR),onClick:()=>H()}),t(I,{label:"Excluir",className:"p-button-danger",icon:"pi pi-trash",iconPos:"left",disabled:!i.length||!$(R.CATALOGO,j.EXCLUIR),onClick:()=>te(),style:{gap:"10px",borderColor:"#c1c1c1",fontSize:"12px",backgroundColor:"var(--color-in-menu)"}})]}),t(Le,{model:d,popup:!0,ref:o}),h(he,{value:x,className:"p-datatable-customers",showGridlines:!0,dataKey:"id",filters:y,filterDisplay:"menu",loading:L,globalFilterFields:["id","descricao","ativo","sigla"],header:e,emptyMessage:"Nenhum dado encontrado.",paginator:!0,responsiveLayout:"scroll",paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {first} / {last} de {totalRecords}",rows:V,rowsPerPageOptions:[10,20,50],scrollable:!0,scrollHeight:"58vh",removableSort:!0,children:[t(g,{headerClassName:"header-table",headerStyle:{width:"2em",backgroundColor:p.backgroundColor,color:p.textColor},bodyStyle:{backgroundColor:p.backgroundColor,color:p.textColor},body:a=>a.privado?"":t("input",{type:"checkbox",onChange:m=>X(a,m)})}),t(g,{field:"id",header:"Código",style:{minWidth:"2rem",maxWidth:"3rem"},headerClassName:"header-table",...f,sortable:!0}),t(g,{field:"descricao",header:"Descrição",showFilterMatchModes:!1,style:{maxWidth:"6rem"},headerClassName:"header-table",...f,sortable:!0}),t(g,{field:"ativo",header:"Situação",body:a=>t(Te,{value:a.ativo}),style:{width:"2rem"},headerClassName:"header-table",...f,sortable:!0}),t(g,{header:"Ações",body:a=>t(I,{label:"",icon:"pi pi-ellipsis-v",className:"p-button-text",onClick:m=>{o.current!=null&&o.current.toggle(m),c(a),b(a)}}),style:{width:"1rem"},headerClassName:"header-table",...f})]})]})}export{Ve as default};
