import{av as we,s as ge,b as ye,r,al as Ae,i as Ne,d as Te,W as _e,j as l,a as e,Y as Fe,$ as D,D as pe,a2 as De,E as Le,B as X,ag as ke,h as Ie,aw as Me,a7 as me,an as Re,a0 as ve,ak as he,M as qe,ai as ze,ah as c,ax as Be,ay as h,az as T,aA as He,aD as We,aB as Oe,aC as Ve,aE as Ee,aF as Ge,aG as $e}from"./index-7cffcf74.js";import{u as Pe}from"./contasPagarService-ecf87c9d.js";import{H as je,F as Xe,C as Ue,S as xe,a as Ke,P as Ye}from"./PaymentDialog-67fcf84e.js";import{F as Je}from"./FinanceiroCards-f3722aec.js";import{D as Se}from"./divider.esm-73291a01.js";import{u as Qe,a as Ze}from"./caixasService-88bc5f93.js";import"./CancellationDialog-f0bfaa37.js";import"./inputtextarea.esm-a186b3b2.js";import"./finaceiroService-9884a8b3.js";const ea=we`
  from {
    transform: translateX(100%);
  }

  to {
    transform: translateX(0%);
  }
`,aa=ge.div`
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  width: 100%;
  padding: 20px;
  gap: 20px;
  animation: ${ea} 0.3s linear alternate;
  @media (min-width: 1024px) and (max-width: 1366px) {
    padding: 10px;
    gap: 10px;
  }
`,ta=ge.div`
  display: flex;
  width: 100%;
  justify-content: space-between;
`,oa=ge.article`
  display: flex;
  align-items: center;
  gap: 16px;
  @media (min-width: 1024px) and (max-width: 1366px) {
    button {
      height: 25px;
      font-size: 8px !important;
      pi {
        font-size: 10px;
      }
    }
  }
`;function ra({visible:d,contasPagar:L,togglePagarDialog:k,refreshList:U,setListContas:B}){const{tokenSignature:H,storeUser:W}=ye(t=>t),[A,fe]=r.useState(new Date),[I,M]=r.useState("CAIXA"),[K,O]=r.useState(!1),[g,_]=r.useState([]),[v,Y]=r.useState([]),[J,Q]=r.useState([]);r.useState();const[Ce,Z]=r.useState([]),{getAllContaCorrenteService:V}=Qe(),{getFormaPagamentoService:ee}=Ae(),{getAllCaixaService:ae}=Ze(),{openNotification:x}=Ne(),{getBaixaContaPagarService:E,newBaixaContaPagarService:R}=Pe(),{formContasPagar:te,setRefreshListContasPagar:be,refreshListContasPagar:G}=Te(t=>t),{register:$,formState:{errors:S},handleSubmit:oe,control:y,setValue:j,reset:f}=_e({defaultValues:{sequencial:0,tipo:"CAIXA",tipo_recebimento:"DIN",valor_multa:0,valor_desconto:0,data_pagamento:A==null?void 0:A.toISOString(),valor_juros:0},reValidateMode:"onChange"}),re=()=>{f(),k(),Z([]),G()},le=async t=>{O(!0);const p=new Date(t.data_pagamento).setHours(new Date().getHours()-3,new Date().getMinutes());R({...t,data_pagamento:new Date(p).toISOString()},L).then(o=>{let u=o.data[0].msg,C=o.data[0].erro;if(C&&C=="true"){x("error","Falha ao Cadastrar",`${u||"Erro ao cadastrar"}`,1e4);return}C&&C=="false"&&x("success","Sucesso",`${u||"Cadastro realizado com sucesso"}`),f(),j("valor_juros",0),j("identificador",""),M("CAIXA"),U();const P=document.getElementsByTagName("input");for(let w of P)w.checked=!1;B([]),setTimeout(()=>{k()},1500)}).catch(o=>{console.warn(o),x("error","Falha ao Cadastrar","",1e4)}).finally(()=>O(!1))},ne=()=>{ae().then(t=>{console.log(t.data),Y(t.data)}).catch(t=>{console.warn(t),x("warn","Falha","Não foi possivel obter lista de caixas disponíveis")})},se=()=>{V().then(t=>{console.log(t.data),_(t.data)}).catch(t=>{console.warn(t),x("warn","Falha","Não foi possivel obter lista de bancos disponíveis")})},ie=()=>{ee().then(t=>{Q(t.data)}).catch(()=>{x("warn","Falha","Não foi possivel obter lista de bancos disponíveis")})};r.useEffect(()=>{H&&d&&(ne(),se(),ie())},[H,d]);const ce=l(je,{children:["Pagar -"," ",L.map(t=>t.sequencial).sort().join(", ")]});return e(Fe,{visible:d,onHide:re,header:ce,style:{minWidth:"70vw",minHeight:"50vh"},maximizable:!0,children:l(Xe,{onSubmit:oe(le),children:[e(Se,{align:"left",children:"Tipo de Conta"}),e(D,{name:"tipo",control:y,rules:{required:!0},render:({field:{value:t,onChange:p}})=>l(Ue,{children:[e("input",{type:"radio",value:"CAIXA",name:"tipo",id:"caixa",onChange:o=>{M(o.target.value),p(o.target.value)},checked:t==="CAIXA"}),e("label",{htmlFor:"caixa",children:"Caixa"}),e("input",{type:"radio",value:"CONTA-CORRENTE",name:"tipo",id:"conta",onChange:o=>{M(o.target.value),p(o.target.value)},checked:t==="CONTA-CORRENTE"}),e("label",{htmlFor:"conta",children:"Conta Corrente"})]})}),e(Se,{align:"left",children:"Pagamento"}),l(xe,{children:[I==="CAIXA"?e(D,{render:({field:{onChange:t,onBlur:p,value:o,name:u,ref:C},fieldState:{invalid:P,isTouched:w,isDirty:q,error:z}})=>{var s;return l("span",{className:"p-float-label",style:{flex:1,fontSize:"12px"},children:[e(pe,{id:"caixa",value:o,filter:!0,optionLabel:"codigo_descricao",optionValue:"caixa",options:v,style:{width:"100%",height:"35px"},placeholder:"Caixa",onChange:i=>t(i.value),emptyMessage:"Nenhum resultado disponível",className:((s=S.tipo_id)==null?void 0:s.type)==="required"?"p-invalid":""}),l("label",{htmlFor:"caixa",children:["Caixa",e("span",{children:"*"})]})]})},name:"tipo_id",control:y,rules:{required:!0}}):e(D,{render:({field:{onChange:t,onBlur:p,value:o,name:u,ref:C},fieldState:{invalid:P,isTouched:w,isDirty:q,error:z}})=>{var s;return l("span",{className:"p-float-label",style:{flex:1,minWidth:"150px",fontSize:"12px"},children:[e(pe,{id:"conta_corrente",value:o,filter:!0,optionLabel:"nome",optionValue:"conta_corrente",options:g,style:{width:"100%",height:"35px",fontSize:"12px"},placeholder:"Conta Corrente",onChange:i=>t(i.value),emptyMessage:"Nenhum resultado disponível",className:((s=S.tipo_id)==null?void 0:s.type)==="required"?"p-invalid":""}),l("label",{htmlFor:"conta_corrente",children:["Conta Corrente",e("span",{children:"*"})]})]})},name:"tipo_id",control:y,rules:{required:!0}}),e(D,{name:"data_pagamento",control:y,rules:{required:!0},render:({field:t,fieldState:p})=>{var o;return l("span",{className:"p-float-label",style:{flex:1,minWidth:"120px",fontSize:"12px"},children:[e(De,{...$("data_pagamento",{required:!0}),value:A,mask:"99/99/9999",onChange:u=>{t.onChange(new Date(u.value).toISOString()),fe(u.value)},dateFormat:"dd/mm/yy",view:"date",showIcon:!0,style:{height:"35px",width:"100%",translate:"0px 1px",minWidth:"200px",flex:1},maxDate:new Date,placeholder:"Data Pagamento",inputId:"data_pagamento",className:((o=S.data_pagamento)==null?void 0:o.type)==="required"?"p-invalid":""}),e("label",{htmlFor:"data_pagamento",children:"Data"})]})}}),e(D,{render:({field:{onChange:t,onBlur:p,value:o,name:u,ref:C},fieldState:{invalid:P,isTouched:w,isDirty:q,error:z}})=>{var s;return l("span",{className:"p-float-label",style:{flex:1,minWidth:"200px",fontSize:"12px"},children:[e(pe,{id:"tipo_recebimento",value:o,optionLabel:"descricao",optionValue:"tipo",options:J.map(i=>({...i,descricao:`${i.tipo} - ${i.descricao}`})),style:{width:"100%",height:"35px",fontSize:"12px"},placeholder:"Forma de Pagamento",onChange:i=>t(i.value),emptyMessage:"Nenhum resultado disponível",className:((s=S.tipo_recebimento)==null?void 0:s.type)==="required"?"p-invalid":""}),l("label",{htmlFor:"tipo_recebimento",children:["Forma de Pagamento",e("span",{children:"*"})]})]})},name:"tipo_recebimento",control:y,rules:{required:!0}})]}),e(xe,{children:e(D,{render:({field:{onChange:t,onBlur:p,value:o,name:u,ref:C},fieldState:{invalid:P,isTouched:w,isDirty:q,error:z}})=>{var s;return l("span",{className:"p-float-label",style:{flex:1,fontSize:"12px"},children:[e(Le,{value:o||"",onChange:i=>t(i.target.value),style:{width:"100%",height:"35px"},className:((s=S.identificador)==null?void 0:s.type)==="required"?"p-invalid":""}),l("label",{htmlFor:"identificador",children:["Identificador",e("span",{children:"*"})]})]})},name:"identificador",control:y,rules:{required:!0}})}),e(Ke,{children:e(X,{label:"Baixa",loading:K,icon:"pi pi-dollar",className:"p-button-danger save-btn-form",iconPos:"left",style:{gap:"10px",height:"35px",fontSize:"10px"},type:"submit",onClick:()=>console.log(S)})})]})})}function ha(){const{colors:d}=r.useContext(ke),[L,k]=r.useState(),[U,B]=r.useState(""),[H,W]=r.useState(!1),[A,fe]=r.useState(10),[I,M]=r.useState([]),[K,O]=r.useState({valor_total:0}),[g,_]=r.useState([]),[v,Y]=r.useState(null),[J,Q]=r.useState(!1),[Ce,Z]=r.useState(!1),{tokenSignature:V,storeUser:ee}=ye(a=>a),{getAllContasPagarService:ae,deleteContasPagarService:x}=Pe(),{havePermission:E}=Ie(),{openNotification:R}=Ne(),{formContasPagar:te,setRefreshListContasPagar:be}=Te(a=>a),G=()=>{Q(a=>!a)},$=()=>{Z(a=>!a)},S=a=>{const n=a.target.value;let m={...L};m.global.value=n,k(m),B(n)},oe=()=>{k({global:{value:null,matchMode:h.CONTAINS},empresa:{operator:T.AND,constraints:[{value:null,matchMode:h.STARTS_WITH}]},sequencial:{operator:T.AND,constraints:[{value:null,matchMode:h.STARTS_WITH}]},razao_social:{value:null,matchMode:h.IN},ativo:{operator:T.AND,constraints:[{value:null,matchMode:h.STARTS_WITH}]},vencimento:{operator:T.AND,constraints:[{value:null,matchMode:h.CONTAINS}]},valor_documento:{operator:T.AND,constraints:[{value:null,matchMode:h.STARTS_WITH}]},situacao:{operator:T.AND,constraints:[{value:null,matchMode:h.STARTS_WITH}]},entrada:{operator:T.AND,constraints:[{value:null,matchMode:h.STARTS_WITH}]},nota_fiscal:{operator:T.AND,constraints:[{value:null,matchMode:h.STARTS_WITH}]}}),B("")};r.useEffect(()=>{oe(),V&&f(),be(f)},[V,ee]);const y=a=>He(a.vencimento.split("T")[0]),j=(a,n)=>{const m=n.target.checked;let F=a.sequencial,b=g;if(m){b==null||b.push({sequencial:+F,valor_documento:a.valor_documento});let de=b.filter(ue=>ue.sequencial!=0);_(de)}else{let de=b==null?void 0:b.filter(ue=>ue.sequencial!=+F);_(de)}},f=()=>{W(!0),ae().then(a=>{M(a.data),s(a.data),W(!1)}).catch(a=>{R("warn","Falha ao obter lista de contas a pagar disponíveis"),console.error(a)}).finally(()=>W(!1))},{listModuleFilters:re,operatorsFilters:le,createFilter:ne,loading:se,clearFilter:ie,haveApplyFilters:ce}=Me({module:me.CONTAS_A_PAGAR,refreshList:f}),t=a=>{We({message:`Você está certo que deseja apagar o${g.length>1?"s":""} registro${g.length>1?"s":""} selecionado${g.length>1?"s":""}?`,header:"Confirmar",icon:"pi pi-exclamation-triangle",rejectLabel:"Cancelar",acceptLabel:"Sim",acceptClassName:"red",accept:()=>p(a),reject:()=>null})},p=a=>{x([{sequencial:a}]).then(n=>{let m=n.data[0].msg;R("success","Sucesso",`${m||""}`),_([]),f();const F=document.getElementsByTagName("input");for(let b of F)b.checked=!1}).catch(n=>{console.error(n),R("error","Falha na execução",`${n.response.data.msg}`,1e4)})},o=r.useRef(null);let u=[{label:"Opções",items:[{label:"Visualizar",icon:"pi pi-fw pi-eye",command:a=>te(v)},{label:"Excluir",icon:"pi pi-fw pi-trash",command:a=>{t(Number(v==null?void 0:v.sequencial))},disabled:!E(6020,6)},{label:"Baixa",icon:"pi pi-fw pi-dollar",command:()=>G()}]}];const P=(()=>l(Ee,{children:[e(Ge,{listModuleFilters:re,operatorsFilters:le,setFilters:ne,loading:se,clearFilter:ie,haveApplyFilters:ce}),l("span",{className:"p-input-icon-left",style:{height:"30px"},children:[e("i",{className:"pi pi-search"}),e($e,{value:U,onChange:S,placeholder:"Buscar"})]})]}))(),w=a=>e("div",{className:"cell-num",children:he(a.valor_documento)}),q=()=>e("div",{children:he(K.valor_total)}),z=()=>I.length?I.reduce((a,n)=>a+(n.valor_documento||0),0):0,s=a=>{const n=a.reduce((m,F)=>m+(F.valor_documento||0),0);O(m=>({...m,valor_total:n}))},i=e(Oe,{children:l(Ve,{children:[e(c,{footer:"Total:",colSpan:6,footerStyle:{textAlign:"right",fontWeight:"bold"}}),e(c,{footer:q,footerStyle:{fontWeight:"bold",textAlign:"right"}}),e(c,{footer:""}),e(c,{footer:""})]})}),N={headerStyle:{fontSize:"14px",fontWeight:"bold",backgroundColor:d.backgroundColor,color:d.textColor},bodyStyle:{fontSize:"12px",fontWeight:600,backgroundColor:d.backgroundColor,color:d.textColor}};return l(aa,{children:[e(Re,{}),l(ta,{children:[l(oa,{children:[e(X,{label:"Nova Conta a Pagar",icon:"pi pi-plus-circle",iconPos:"left",className:"p-button-primary new-btn",disabled:!E(me.CONTAS_A_PAGAR,ve.INCLUIR),onClick:()=>te(null)}),e(X,{label:"Baixa em Lote",className:"p-button-danger",icon:"pi pi-dollar",iconPos:"left",onClick:()=>$(),disabled:!g.length||!E(me.CONTAS_A_PAGAR,ve.INCLUIR),style:{gap:"10px",borderColor:"#c1c1c1",fontSize:"12px",backgroundColor:"var(--color-in-menu)"}})]}),e(Je,{label:"Total Geral",value:he(z())})]}),e(qe,{model:u,popup:!0,ref:o}),l(ze,{value:I,className:"p-datatable-customers",showGridlines:!0,dataKey:"sequencial",filters:L,filterDisplay:"menu",loading:H,globalFilterFields:["empresa","sequencial","razao_social","vencimento","valor_documento","situacao","entrada","nota_fiscal"],header:P,emptyMessage:"Nenhum dado encontrado.",paginator:!0,paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {last} de {totalRecords}",rows:A,rowsPerPageOptions:[10,20,50],footerColumnGroup:i,onValueChange:s,scrollable:!0,scrollHeight:"58vh",style:{overflowX:"auto"},removableSort:!0,children:[e(c,{headerClassName:"header-table",bodyClassName:"cell-table",headerStyle:{width:"2em",backgroundColor:d.backgroundColor,color:d.textColor},bodyStyle:{backgroundColor:d.backgroundColor,color:d.textColor,height:"20px"},body:a=>e("input",{type:"checkbox",onChange:n=>j(a,n),disabled:a.situacao==="PAGO"})}),e(c,{field:"sequencial",header:"Código",showFilterMatchModes:!1,headerClassName:"header-table",bodyClassName:"cell-table",style:{width:"2rem"},...N,sortable:!0}),e(c,{field:"razao_social",header:"Fornecedor",headerClassName:"header-table",bodyClassName:"cell-table",style:{width:"250px"},...N,sortable:!0}),e(c,{field:"entrada",header:"Cod. Entrada",headerClassName:"header-table",bodyClassName:"cell-table",style:{width:"130px"},...N,sortable:!0}),e(c,{field:"nota_fiscal",header:"Nota Fiscal",headerClassName:"header-table",bodyClassName:"cell-table",style:{width:"130px"},...N,sortable:!0}),e(c,{field:"vencimento",header:"Vencimento",dataType:"date",body:y,headerClassName:"header-table",bodyClassName:"cell-table",style:{width:"50px"},...N,sortable:!0}),e(c,{field:"valor_documento",header:"Valor",bodyClassName:"text-center cell-table",headerClassName:"header-table header-table-num",style:{width:"3rem",textAlign:"center"},...N,sortable:!0,body:w}),e(c,{field:"situacao",header:"Situação",dataType:"text",body:a=>e(Be,{value:a.situacao}),headerClassName:"header-table",bodyClassName:"cell-table",style:{width:"0.5rem"},...N,sortable:!0}),e(c,{header:"Ações",headerClassName:"header-table",body:a=>e(X,{label:"",icon:"pi pi-ellipsis-v",className:"p-button-text",style:{padding:0,minWidth:"0.8rem"},onClick:n=>{o.current!=null&&o.current.toggle(n),Y(a)}}),style:{width:"1rem"},...N})]}),v&&e(Ye,{contaPagar:v,visible:J,togglePagarDialog:G,refreshList:f}),g&&e(ra,{contasPagar:g,visible:Ce,togglePagarDialog:$,refreshList:f,setListContas:_})]})}export{ha as default};
