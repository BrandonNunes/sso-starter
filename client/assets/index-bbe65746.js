import{av as Ne,s as z,r as o,a as e,Y as X,j as i,ai as j,ah as a,al as K,i as Y,ab as Ve,B as G,ak as h,ag as we,d as Re,h as Fe,b as Pe,aw as Me,a7 as Q,an as Ae,a0 as Le,M as Ie,ax as We,ay as T,az as W,aA as De,aB as ke,aC as Ee,aD as He,aE as Oe,aF as Be,aG as $e}from"./index-7cffcf74.js";import{C as Ge,D as ze,b as je,i as qe}from"./utils-260be428.js";import{u as Ue,E as J,a as Qe,b as Xe}from"./processOrCancelService-8c998701.js";import{u as Ke}from"./productsService-a4f11891.js";import{F as $}from"./FinanceiroCards-f3722aec.js";const Ye=Ne`
  from {
    transform: translateX(100%);
  }

  to {
    transform: translateX(0%);
  }
`,Je=z.div`
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  width: 100%;
  padding: 20px;
  gap: 20px;
  animation: ${Ye} 0.3s linear alternate;
  .p-datatable .p-datatable-header {
    background-color: ${n=>n.theme.colors.backgroundColor};
  }
  @media (min-width: 1024px) and (max-width: 1366px) {
    padding: 10px;
    gap: 10px;
  }
`,Ze=z.div`
  display: flex;
  width: 100%;
  justify-content: space-between;
`,et=z.article`
  display: flex;
  align-items: center;
  gap: 16px;
  @media (min-width: 1024px) and (max-width: 1366px) {
    button {
      height: 25px;
      font-size: 8px !important;
      pi {
        font-size: 10px;
      }
    }
  }
`;function tt({open:n,setOpen:C,product:r,idMovimentacao:g}){const[S,N]=o.useState([]),[x,m]=o.useState(!1),{getRastreioProductService:c}=Ue(),V=()=>{c(J.Venda,g,r.produto).then(p=>{N(p.data)}).catch(p=>{console.log(p)})},f=()=>S.length?S.reduce((b,R)=>b+R.quantidade,0):0,w=()=>{C(!1)};return o.useLayoutEffect(()=>{r&&g&&V()},[r,g]),e(X,{visible:n,header:"Itens do Rastreio",maximizable:!0,style:{minWidth:"40vw",minHeight:"40vh"},onHide:w,children:i(Ge,{children:[i(ze,{children:["Movimentação - ",g," / Produto ",r&&r.produto," ",r.descricao?`- ${r.descricao}`:""]}),i(je,{children:["Rastreados: ",f()," de ",r?r.quantidade:""]}),i(j,{value:S,loading:x,scrollable:!0,scrollHeight:"50vh",style:{minWidth:"50rem"},emptyMessage:"Sem itens encontrados",children:[e(a,{header:"Código",field:"id"}),e(a,{header:"Serial Inicial",field:"serial_inicial"}),e(a,{header:"Serial Final",field:"serial_final"})]})]})})}function at({open:n,toggleOpen:C,venda:r}){const[g,S]=o.useState(0),[N,x]=o.useState([]),[m,c]=o.useState([]),[V,f]=o.useState(!1),[w,p]=o.useState(!1),[b,R]=o.useState(null),{getListItemVendaService:M}=K(),{getMedidaBaseService:A}=Ke(),{openNotification:F}=Y(),L=()=>{f(!0),M(r==null?void 0:r.pedido).then(s=>{console.log(s.data),x(s.data)}).catch(s=>{console.log(s)}).finally(()=>f(!1))},D=()=>{A().then(s=>{c(s.data)}).catch(s=>{console.error(s),F("warn","Falha ao obter catálogo de orgão expeditor disponíveis")})};o.useEffect(()=>{r!=null&&r.pedido&&(L(),S(r.pedido),m.length||D())},[r,n]);const k=()=>{C()},I=()=>i("div",{children:["Itens do Pedido - ",g||""]}),E=s=>{const{qtdRastreios:H}=Qe({tipoMovimentacao:J.Venda,codMovimentacao:s.pedido,codProduto:s.produto});return e("div",{style:{display:"flex",gap:"5px"},children:s.obrigar_rastreamento||r&&s.obrigar_rastreamento?e(Ve,{children:e(G,{type:"button",label:"",icon:"pi pi-qrcode",size:"small",severity:"danger",title:"Rastrear",className:"p-button-text p-button-sm",style:{fontSize:"12px",color:Number(H)>=Number(s.quantidade)?"blue":"#d00"},onClick:()=>{p(O=>!O),R(s)}})}):""})};return i(X,{header:I,visible:n,onHide:k,style:{minWidth:"50vw",minHeight:"50vh"},closeOnEscape:!0,children:[b&&e(tt,{product:b,open:w,setOpen:p,idMovimentacao:b.pedido}),i(j,{value:N,loading:V,emptyMessage:"Nenhum item encontrado",children:[e(a,{header:"Produto",field:"produto"}),e(a,{header:"Descrição",field:"descricao"}),e(a,{header:"Quantidade",field:"quantidade"}),e(a,{header:"Valor Unitário",field:"valor_unitario",body:ot}),e(a,{header:"Valor Total",field:"valor_total",body:rt}),e(a,{body:E,header:""})]})]})}const ot=n=>e("div",{children:h(n.valor_unitario)}),rt=n=>e("div",{children:h(n.valor_total)});function ut(){const{colors:n}=o.useContext(we),{formVenda:C,setRefreshListVenda:r}=Re(t=>t),{getAllVendaService:g,deleteVendaService:S}=K(),{processOrCancelService:N}=Xe(),{havePermission:x}=Fe(),{openNotification:m}=Y(),[c,V]=o.useState([]),[f,w]=o.useState({valor_total:0,valor_pago:0,valor_a_receber:0}),[p,b]=o.useState(),[R,M]=o.useState(!1),[A,F]=o.useState(null);o.useState([]);const{tokenSignature:L,storeUser:D}=Pe(t=>t),[k,I]=o.useState(""),[E,s]=o.useState(10),[H,O]=o.useState(),[Z,ee]=o.useState(!1),q=()=>{ee(t=>!t),F(null)},B=o.useRef(null),te=()=>{C(A)},P=()=>{M(!0),g().then(t=>{V(t.data.reverse()),U(t.data)}).catch(t=>{console.error(t),m("warn","Falha ao obter lista de vendas disponíveis",`${t.response.data.msg}`)}).finally(()=>M(!1))},{listModuleFilters:ae,operatorsFilters:oe,createFilter:re,loading:le,clearFilter:se,haveApplyFilters:ne}=Me({module:Q.VENDA,refreshList:P}),ie=(t,l,u)=>{N(t,l,u).then(y=>{let d=y.data[0].msg;if(y.data[0].erro==="true"){m("warn","Falha",`${d||""}`);return}m("success","Sucesso",`${d||""}`),P()}).catch(y=>{console.error(y),m("error","Falha na execução",`${y.response.data.msg}`,1e4)})},de=t=>{S(t).then(l=>{let u=l.data[0].msg;if(l.data[0].erro==="true"){m("warn","Falha",`${u||""}`);return}m("success","Sucesso",`${u||""}`),P()}).catch(l=>{console.error(l),m("error","Falha na execução",`${l.response.data.msg}`,1e4)})},ce=t=>{const l=t.target.value;let u={...p};u.global.value=l,b(u),I(l)},ue=t=>{He({message:"Você está certo que deseja apagar este registro?",header:"Confirmar",icon:"pi pi-exclamation-triangle",rejectLabel:"Cancelar",acceptLabel:"Sim",acceptClassName:"red",accept:()=>de(t),reject:()=>null})},he=(()=>i(Oe,{children:[e(Be,{listModuleFilters:ae,operatorsFilters:oe,setFilters:re,loading:le,clearFilter:se,haveApplyFilters:ne}),i("span",{className:"p-input-icon-left",style:{height:"30px"},children:[e("i",{className:"pi pi-search"}),e($e,{value:k,onChange:ce,placeholder:"Buscar"})]})]}))(),me=()=>{b({global:{value:null,matchMode:T.CONTAINS},entrada:{operator:W.AND,constraints:[{value:null,matchMode:T.STARTS_WITH}]},nome_fornecedor:{operator:W.AND,constraints:[{value:null,matchMode:T.STARTS_WITH}]},data:{value:null,matchMode:T.CONTAINS},situacao:{operator:W.AND,constraints:[{value:null,matchMode:T.STARTS_WITH}]},nota_fiscal:{operator:W.AND,constraints:[{value:null,matchMode:T.STARTS_WITH}]}}),I("")},pe=t=>De(t.data_pedido),ge=t=>e("div",{className:"cell-num",children:h(t.valor_total)}),fe=t=>e("div",{className:"cell-num",children:h(t.valor_pago)}),be=t=>e("div",{className:"cell-num",children:h(t.valor_a_receber)}),ve=()=>c.length?c.reduce((t,l)=>t+(l.valor_total||0),0):0,ye=()=>c.length?c.reduce((t,l)=>t+(l.valor_pago||0),0):0,Se=()=>c.length?c.reduce((t,l)=>t+(l.valor_a_receber||0),0):0,Ce=()=>e("div",{children:h(f.valor_total)}),xe=()=>e("div",{children:h(f.valor_pago)}),_e=()=>e("div",{children:h(f.valor_a_receber)}),U=t=>{const l=t.reduce((d,_)=>d+(_.valor_total||0),0),u=t.reduce((d,_)=>d+(_.valor_pago||0),0),y=t.reduce((d,_)=>d+(_.valor_a_receber||0),0);w(d=>({...d,valor_total:l,valor_pago:u,valor_a_receber:y}))},Te=e(ke,{children:i(Ee,{children:[e(a,{footer:"Total:",colSpan:3,footerStyle:{textAlign:"right",fontWeight:"bold"}}),e(a,{footer:Ce,footerStyle:{fontWeight:"bold",textAlign:"right"}}),e(a,{footer:xe,footerStyle:{fontWeight:"bold",textAlign:"right"}}),e(a,{footer:_e,footerStyle:{fontWeight:"bold",textAlign:"right"}}),e(a,{footer:""}),e(a,{footer:""})]})});o.useEffect(()=>{r(P),me(),L&&P()},[L,D]);const v={headerStyle:{fontSize:"14px",fontWeight:"bold",backgroundColor:n.backgroundColor,color:n.textColor},bodyStyle:{fontSize:"12px",fontWeight:600,backgroundColor:n.backgroundColor,color:n.textColor}};return i(Je,{children:[e(at,{open:Z,toggleOpen:q,venda:A}),e(Ae,{}),i(Ze,{children:[e(et,{children:e(G,{label:"Nova Venda",icon:"pi pi-plus-circle",iconPos:"left",className:"p-button-primary new-btn",disabled:!x(Q.VENDA,Le.INCLUIR),onClick:()=>{C(),F(null)}})}),e($,{label:"Total Geral",value:h(ve())}),e($,{label:"Total Pago",color:"#6366F1",value:h(ye())}),e($,{label:"Total a Receber",color:"#F59E0B",value:h(Se())})]}),e(Ie,{model:qe(ue,H,x,q,te,ie),popup:!0,ref:B}),i(j,{value:c,className:"p-datatable-customers",showGridlines:!0,dataKey:"pedido",filters:p,filterDisplay:"menu",loading:R,globalFilterFields:["pedido","cliente","nome_cliente","data_pedido","observacao","situacao","valor_total","valor_pago","valor_a_receber","CodigoExterno"],onValueChange:U,header:he,emptyMessage:"Nenhum dado encontrado.",paginator:!0,responsiveLayout:"scroll",paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {first} / {last} de {totalRecords}",rows:E,rowsPerPageOptions:[10,20,50],footerColumnGroup:Te,scrollable:!0,scrollHeight:"58vh",removableSort:!0,children:[e(a,{field:"pedido",header:"Venda",showFilterMatchModes:!1,style:{width:"2rem"},headerClassName:"header-table",bodyClassName:"cell-table",...v,sortable:!0}),e(a,{field:"nome_cliente",header:"Cliente",filterMenuStyle:{width:"14rem"},style:{maxWidth:"12rem"},headerClassName:"header-table",bodyClassName:"cell-table cliente-venda",...v,sortable:!0}),e(a,{field:"data_pedido",header:"Data do Pedido",dataType:"date",body:pe,style:{maxWidth:"5rem"},headerClassName:"header-table",bodyClassName:"cell-table",...v,sortable:!0}),e(a,{field:"valor_total",header:"Valor",filterMenuStyle:{width:"14rem"},style:{maxWidth:"12rem",textAlign:"center"},headerClassName:"header-table header-table-num",bodyClassName:"cell-table",...v,sortable:!0,body:ge}),e(a,{field:"valor_pago",header:"Pago",filterMenuStyle:{width:"14rem"},style:{maxWidth:"12rem",textAlign:"center"},headerClassName:"header-table header-table-num",bodyClassName:"cell-table",...v,sortable:!0,body:fe}),e(a,{field:"valor_a_receber",header:"A Receber",filterMenuStyle:{width:"14rem"},style:{maxWidth:"12rem",textAlign:"center"},headerClassName:"header-table header-table-num",bodyClassName:"cell-table",...v,sortable:!0,body:be}),e(a,{field:"situacao",header:"Situação",body:t=>e(We,{value:t.situacao}),style:{width:"4rem"},headerClassName:"header-table",bodyClassName:"cell-table",...v,sortable:!0}),e(a,{header:"Ações",body:t=>e(G,{label:"",icon:"pi pi-ellipsis-v",className:"p-button-text",onClick:l=>{B.current!=null&&(B.current.toggle(l),O(t)),F(t)}}),headerClassName:"header-table",bodyClassName:"cell-table",style:{width:"1rem"},...v})]})]})}export{ut as default};
